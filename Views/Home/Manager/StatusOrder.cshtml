@model List<moon.Models.Order>
@{
    Layout = "~/Views/Shared/Manager.cshtml";
    ViewData["Title"] = "Tr·∫°ng th√°i ƒë∆°n h√†ng";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 text-gray-800">Danh s√°ch ƒë∆°n h√†ng</h1>
        <a href="/Product/Add" class="btn btn-primary">
            <i class="fas fa-save"></i> L∆∞u
        </a>
    </div>

    <div class="card shadow mb-4">
        <div class="card-header py-3 d-flex justify-content-between align-items-center">
            <h6 class="m-0 font-weight-bold text-primary">B·∫£ng h√≥a ƒë∆°n:</h6>
        </div>

        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th>ID ƒë∆°n h√†ng</th>
                            <th>Kh√°ch h√†ng</th>
                            <th>S·ªë ƒëi·ªán tho·∫°i</th>
                            <th>ƒê·ªãa ch·ªâ giao h√†ng</th>
                            <th>Ng√†y ƒë·∫∑t h√†ng</th>
                            <th>T·ªïng ti·ªÅn</th>
                            <th>Tr·∫°ng th√°i ƒë∆°n h√†ng</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var order in Model)
                        {
                            <tr>
                                <td>@order.Id</td>
                                <td>@order.FullName</td>
                                <td>@order.PhoneNumber</td>
                                <td class="address"
                                    data-province="@order.Province"
                                    data-district="@order.District"
                                    data-ward="@order.Ward">
                                    ƒêang t·∫£i...
                                </td>
                                <td>@order.OrderDate.ToString("yyyy-MM-dd HH:mm")</td>
                                <td>@order.TotalAmount VNƒê</td>
                                <td>
                                    <select class="form-control">
                                        <option selected>@order.Status</option>
                                        <option>ƒêang x·ª≠ l√Ω</option>
                                        <option>ƒêang giao h√†ng</option>
                                        <option>Th√†nh c√¥ng</option>
                                        <option>ƒê√£ hu·ª∑</option>
                                    </select>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    document.addEventListener("DOMContentLoaded", async () => {
        const res = await fetch("https://provinces.open-api.vn/api/?depth=3");
        const provinces = await res.json();

        document.querySelectorAll(".address").forEach(cell => {
            const pCode = parseInt(cell.dataset.province);
            const dCode = parseInt(cell.dataset.district);
            const wCode = parseInt(cell.dataset.ward);

            let provinceName = "", districtName = "", wardName = "";

            const province = provinces.find(p => p.code === pCode);
            if (province) {
                provinceName = province.name;
                const district = province.districts.find(d => d.code === dCode);
                if (district) {
                    districtName = district.name;
                    const ward = district.wards.find(w => w.code === wCode);
                    if (ward) {
                        wardName = ward.name;
                    }
                }
            }

            // üü¢ ƒê·ªïi th·ª© t·ª±: x√£/ph∆∞·ªùng, huy·ªán/qu·∫≠n, t·ªânh/th√†nh
            cell.textContent = `${wardName}, ${districtName}, ${provinceName}`;
        });
    });
</script>
}

